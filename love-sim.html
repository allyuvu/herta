<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒå‹•ç‰©èªï¼šå¤æ—¥æˆ€æ„›æ¨¡æ“¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .game-container {
            width: 100%;
            max-width: 1000px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }
        
        .game-header {
            background: linear-gradient(to right, #ff7eb3, #65c7f7);
            padding: 20px;
            text-align: center;
            color: white;
            position: relative;
        }
        
        .game-header h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .game-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .game-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* å·¦å´è§’è‰²å€åŸŸ */
        .character-section {
            width: 40%;
            padding: 25px;
            background-color: #f9f9ff;
            border-right: 2px dashed #e1e1e1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .character-title {
            color: #ff6b9d;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .character-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .character-portrait {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid #fff;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s;
        }
        
        .character-portrait:hover {
            transform: scale(1.05);
        }
        
        .character-portrait img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .character-name {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .character-personality {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 25px;
            text-align: center;
            padding: 0 10px;
        }
        
        .affection-meter {
            width: 100%;
            background-color: #f0f0f0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .affection-fill {
            height: 100%;
            background: linear-gradient(to right, #ffb3c6, #ff4d8d);
            border-radius: 15px;
            width: 0%;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .affection-label {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 5px;
            font-size: 0.9rem;
            color: #777;
        }
        
        /* å³å´éŠæˆ²å€åŸŸ */
        .game-section {
            width: 60%;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }
        
        .story-container {
            flex: 1;
            background-color: #fff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            max-height: 350px;
            border: 1px solid #f0f0f0;
        }
        
        .story-text {
            font-size: 1.3rem;
            line-height: 1.6;
            color: #444;
            margin-bottom: 20px;
        }
        
        .story-text::first-letter {
            font-size: 2rem;
            color: #ff6b9d;
            font-weight: bold;
        }
        
        .choices-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .choice-btn {
            padding: 18px 20px;
            background-color: #fff;
            border: 2px solid #e1e1e1;
            border-radius: 12px;
            font-size: 1.1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            color: #555;
            position: relative;
            overflow: hidden;
        }
        
        .choice-btn:hover {
            background-color: #f8f9ff;
            border-color: #65c7f7;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(101, 199, 247, 0.2);
        }
        
        .choice-btn:active {
            transform: translateY(0);
        }
        
        .choice-btn::before {
            content: "â–¶";
            position: absolute;
            left: 15px;
            color: #65c7f7;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .choice-btn:hover::before {
            opacity: 1;
        }
        
        .choice-text {
            margin-left: 10px;
        }
        
        .game-controls {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
        }
        
        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        #restart-btn {
            background-color: #f0f0f0;
            color: #777;
        }
        
        #restart-btn:hover {
            background-color: #e0e0e0;
        }
        
        #save-btn {
            background-color: #65c7f7;
            color: white;
        }
        
        #save-btn:hover {
            background-color: #4ab5e9;
            box-shadow: 0 5px 15px rgba(101, 199, 247, 0.3);
        }
        
        #history-btn {
            background-color: #ffb3c6;
            color: white;
        }
        
        #history-btn:hover {
            background-color: #ff9db6;
            box-shadow: 0 5px 15px rgba(255, 179, 198, 0.3);
        }
        
        /* è§’è‰²é¸æ“‡å€åŸŸ */
        .character-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .char-select-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
        }
        
        .char-select-btn:hover {
            transform: scale(1.1);
        }
        
        .char-select-btn.active {
            border-color: #ff6b9d;
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.2);
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 900px) {
            .game-content {
                flex-direction: column;
                overflow-y: auto;
            }
            
            .character-section, .game-section {
                width: 100%;
            }
            
            .character-section {
                border-right: none;
                border-bottom: 2px dashed #e1e1e1;
            }
            
            .game-container {
                height: auto;
                max-height: 95vh;
            }
            
            .story-container {
                max-height: 300px;
            }
        }
        
        @media (max-width: 600px) {
            .game-header h1 {
                font-size: 2rem;
            }
            
            .character-portrait {
                width: 180px;
                height: 180px;
            }
            
            .character-name {
                font-size: 1.7rem;
            }
            
            .story-text {
                font-size: 1.1rem;
            }
            
            .choice-btn {
                padding: 15px;
                font-size: 1rem;
            }
            
            .control-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
        
        /* å°è©±ç‰¹æ•ˆ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .story-text {
            animation: fadeIn 0.5s ease;
        }
        
        .choice-btn {
            animation: fadeIn 0.5s ease;
        }
        
        /* æ„›å¿ƒç‰¹æ•ˆ */
        .heart {
            position: absolute;
            color: #ff6b9d;
            font-size: 1.5rem;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            100% { transform: translateY(-50px) scale(1); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>å¿ƒå‹•ç‰©èªï¼šå¤æ—¥æˆ€æ„›æ¨¡æ“¬</h1>
            <p>é€™æ˜¯ä¸€å€‹é—œæ–¼å‹æƒ…ã€æˆé•·èˆ‡åˆæˆ€çš„å¤æ—¥æ•…äº‹ã€‚ä½ çš„é¸æ“‡å°‡æ±ºå®šæ•…äº‹çš„ç™¼å±•ï¼</p>
        </div>
        
        <div class="game-content">
            <!-- å·¦å´ï¼šè§’è‰²è³‡è¨Š -->
            <div class="character-section">
                <h2 class="character-title">ç•¶å‰è§’è‰²</h2>
                <div class="character-container">
                    <div class="character-portrait" id="character-portrait">
                        <!-- è§’è‰²é ­åƒå°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
                        <span style="font-size: 5rem;">ğŸ‘¨â€ğŸ“</span>
                    </div>
                    <div class="character-name" id="character-name">æ—æ˜è»’</div>
                    <div class="character-personality" id="character-personality">é™½å…‰é–‹æœ—çš„ç±ƒçƒéšŠéšŠé•·</div>
                    
                    <div class="affection-meter">
                        <div class="affection-fill" id="affection-fill">0%</div>
                    </div>
                    <div class="affection-label">
                        <span>å¥½æ„Ÿåº¦</span>
                        <span id="affection-value">0/100</span>
                    </div>
                    
                    <div style="margin-top: 30px; width: 100%;">
                        <h3 style="color: #65c7f7; margin-bottom: 15px; text-align: center;">é¸æ“‡è§’è‰²</h3>
                        <div class="character-selector">
                            <div class="char-select-btn active" data-char="1">
                                ğŸ‘¨â€ğŸ“
                            </div>
                            <div class="char-select-btn" data-char="2">
                                ğŸ‘©â€ğŸ¨
                            </div>
                            <div class="char-select-btn" data-char="3">
                                ğŸ‘©â€ğŸ’»
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å³å´ï¼šéŠæˆ²å€åŸŸ -->
            <div class="game-section">
                <div class="story-container">
                    <div class="story-text" id="story-text">
                        ä»Šå¤©æ˜¯è½‰å­¸å¾Œçš„ç¬¬ä¸€å¤©ï¼Œä½ æ‡·è‘—å¿å¿‘çš„å¿ƒæƒ…èµ°é€²æ–°å­¸æ ¡ã€‚é™½å…‰æ˜åªšçš„å¤æ—¥æ—©æ™¨ï¼Œæ ¡åœ’è£¡å……æ»¿äº†é’æ˜¥çš„æ°£æ¯ã€‚åœ¨èµ°å»Šä¸Šï¼Œä½ ä¸å°å¿ƒæ’åˆ°äº†ä¸€ä½åŒå­¸ï¼Œä»–æ‰‹ä¸­çš„æ›¸æœ¬æ•£è½ä¸€åœ°...
                    </div>
                </div>
                
                <div class="choices-container" id="choices-container">
                    <!-- é¸æ“‡æŒ‰éˆ•å°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
                    <button class="choice-btn" data-choice="1">
                        <span class="choice-text">ã€Œå°ä¸èµ·ï¼æˆ‘å¹«ä½ æ’¿èµ·ä¾†ã€‚ã€</span>
                    </button>
                    <button class="choice-btn" data-choice="2">
                        <span class="choice-text">ã€ŒæŠ±æ­‰ï¼Œæˆ‘æ²’æ³¨æ„çœ‹è·¯ã€‚ã€</span>
                    </button>
                    <button class="choice-btn" data-choice="3">
                        <span class="choice-text">ã€Œä½ é‚„å¥½å—ï¼Ÿæœ‰æ²’æœ‰å—å‚·ï¼Ÿã€</span>
                    </button>
                </div>
                
                <div class="game-controls">
                    <button class="control-btn" id="restart-btn">
                        <span>ğŸ”„</span>é‡æ–°é–‹å§‹
                    </button>
                    <button class="control-btn" id="history-btn">
                        <span>ğŸ“–</span>å›é¡§æ•…äº‹
                    </button>
                    <button class="control-btn" id="save-btn">
                        <span>ğŸ’¾</span>ä¿å­˜é€²åº¦
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²æ•¸æ“š
        const gameData = {
            currentCharacter: 1, // 1: æ˜è»’, 2: é›…é›¯, 3: å°çª
            day: 1,
            affection: [0, 0, 0], // ä¸‰ä½è§’è‰²çš„å¥½æ„Ÿåº¦
            storyProgress: 0,
            storyHistory: [],
            selectedChoices: []
        };
        
        // è§’è‰²è³‡æ–™
        const characters = {
            1: {
                name: "æ—æ˜è»’",
                personality: "é™½å…‰é–‹æœ—çš„ç±ƒçƒéšŠéšŠé•·",
                emoji: "ğŸ‘¨â€ğŸ“",
                color: "#65c7f7",
                description: "å­¸æ ¡çš„é¢¨é›²äººç‰©ï¼Œç¸½æ˜¯å……æ»¿æ´»åŠ›ï¼Œå°æœ‹å‹éå¸¸è¬›ç¾©æ°£ã€‚"
            },
            2: {
                name: "é™³é›…é›¯",
                personality: "æ–‡éœæº«æŸ”çš„ç¾è¡“ç¤¾ç¤¾å“¡",
                emoji: "ğŸ‘©â€ğŸ¨",
                color: "#ff9ec7",
                description: "å–œæ­¡åœ¨ç¾è¡“æ•™å®¤ç•«ç•«ï¼Œè©±ä¸å¤šä½†è§€å¯ŸåŠ›æ•éŠ³ï¼Œå…§å¿ƒæº«æŸ”ç´°è†©ã€‚"
            },
            3: {
                name: "å¼µå°çª",
                personality: "è°æ˜ç¨ç«‹çš„ç§‘å­¸ç¤¾ç¤¾é•·",
                emoji: "ğŸ‘©â€ğŸ’»",
                color: "#a78ef6",
                description: "ç†ç§‘å¤©æ‰ï¼Œé‚è¼¯æ¸…æ™°ï¼Œå°æ–°å¥‡äº‹ç‰©å……æ»¿å¥½å¥‡å¿ƒï¼Œæœ‰é»å‚²å¬Œã€‚"
            }
        };
        
        // æ•…äº‹è…³æœ¬
        const storyScript = [
            // ç¬¬0å¤© - å…±é€šé–‹å ´
            {
                id: 0,
                text: "ä»Šå¤©æ˜¯è½‰å­¸å¾Œçš„ç¬¬ä¸€å¤©ï¼Œä½ æ‡·è‘—å¿å¿‘çš„å¿ƒæƒ…èµ°é€²æ–°å­¸æ ¡ã€‚é™½å…‰æ˜åªšçš„å¤æ—¥æ—©æ™¨ï¼Œæ ¡åœ’è£¡å……æ»¿äº†é’æ˜¥çš„æ°£æ¯ã€‚åœ¨èµ°å»Šä¸Šï¼Œä½ ä¸å°å¿ƒæ’åˆ°äº†ä¸€ä½åŒå­¸ï¼Œä»–æ‰‹ä¸­çš„æ›¸æœ¬æ•£è½ä¸€åœ°...",
                choices: [
                    { text: "ã€Œå°ä¸èµ·ï¼æˆ‘å¹«ä½ æ’¿èµ·ä¾†ã€‚ã€", next: 1, affection: [5, 0, 0] },
                    { text: "ã€ŒæŠ±æ­‰ï¼Œæˆ‘æ²’æ³¨æ„çœ‹è·¯ã€‚ã€", next: 1, affection: [3, 0, 0] },
                    { text: "ã€Œä½ é‚„å¥½å—ï¼Ÿæœ‰æ²’æœ‰å—å‚·ï¼Ÿã€", next: 1, affection: [8, 0, 0] }
                ],
                character: 1
            },
            // ç¬¬1å¤© - æ˜è»’è·¯ç·š
            {
                id: 1,
                text: "å°æ–¹æŠ¬èµ·é ­ï¼Œéœ²å‡ºä¸€å¼µé™½å…‰å¸¥æ°£çš„è‡‰é¾ã€‚ã€Œæ²’é—œä¿‚å•¦ï¼æ˜¯æˆ‘èµ°è·¯å¤ªå¿«æ²’çœ‹å‰é¢ã€‚ã€ä»–ç¬‘è‘—èªªï¼Œä¸¦è‡ªæˆ‘ä»‹ç´¹ï¼šã€Œæˆ‘å«æ—æ˜è»’ï¼Œä¸‰å¹´äºŒç­ï¼Œç±ƒçƒéšŠçš„ã€‚ä½ æ˜¯æ–°ä¾†çš„è½‰å­¸ç”Ÿå§ï¼Ÿã€",
                choices: [
                    { text: "ã€Œæ˜¯çš„ï¼Œæˆ‘ä»Šå¤©å‰›è½‰ä¾†ã€‚æˆ‘å«[ç©å®¶å]ï¼Œè«‹å¤šæŒ‡æ•™ï¼ã€", next: 2, affection: [10, 0, 0] },
                    { text: "ã€Œå°ï¼Œæˆ‘æ˜¯è½‰å­¸ç”Ÿã€‚ä½ æ€éº¼çŸ¥é“ï¼Ÿã€", next: 2, affection: [5, 0, 0] },
                    { text: "ã€Œå—¯...æŠ±æ­‰ï¼Œæˆ‘å¾—è¶•å»æ•™å®¤äº†ã€‚ã€", next: 3, affection: [-5, 0, 0] }
                ],
                character: 1
            },
            {
                id: 2,
                text: "ã€Œæ­¡è¿ä¾†åˆ°æˆ‘å€‘å­¸æ ¡ï¼æ”¾å­¸å¾Œæœ‰ç±ƒçƒç·´ç¿’ï¼Œè¦ä¸è¦ä¾†çœ‹çœ‹ï¼Ÿã€æ˜è»’ç†±æƒ…åœ°é‚€è«‹ä½ ï¼Œçœ¼ç›é–ƒé–ƒç™¼äº®ã€‚",
                choices: [
                    { text: "ã€Œå¥½å•Šï¼æˆ‘å¾ˆå–œæ­¡ç±ƒçƒã€‚ã€", next: 4, affection: [10, 0, 0] },
                    { text: "ã€ŒæŠ±æ­‰ï¼Œæˆ‘ä»Šå¤©æœ‰é»äº‹...ã€", next: 3, affection: [-3, 0, 0] },
                    { text: "ã€Œæˆ‘ä¸å¤ªæ‡‚ç±ƒçƒï¼Œä½†å»çœ‹çœ‹æ‡‰è©²ä¸éŒ¯ã€‚ã€", next: 4, affection: [5, 0, 0] }
                ],
                character: 1
            },
            {
                id: 3,
                text: "æ˜è»’çš„è¡¨æƒ…æœ‰é»å¤±æœ›ï¼Œä½†é‚„æ˜¯ç¬‘è‘—èªªï¼šã€Œæ²’é—œä¿‚ï¼Œä¸‹æ¬¡æœ‰æ©Ÿæœƒå†èªªå§ï¼æˆ‘å…ˆå»ç·´ç¿’äº†ï¼Œå­¸æ ¡è¦‹ï¼ã€",
                choices: [
                    { text: "ç¹¼çºŒæ•…äº‹", next: 10, affection: [0, 0, 0] }
                ],
                character: 1
            },
            {
                id: 4,
                text: "æ”¾å­¸å¾Œï¼Œä½ ä¾†åˆ°ç±ƒçƒå ´ã€‚æ˜è»’æ­£åœ¨ç·´ç¿’æŠ•ç±ƒï¼Œçœ‹åˆ°ä½ ä¾†äº†ï¼Œä»–é–‹å¿ƒåœ°æ®æ‰‹ã€‚ã€Œä¾†å¾—æ­£å¥½ï¼è¦ä¸è¦è©¦è©¦çœ‹æŠ•ç±ƒï¼Ÿã€",
                choices: [
                    { text: "ã€Œå¥½å•Šï¼è®“æˆ‘è©¦è©¦çœ‹ã€‚ã€", next: 5, affection: [8, 0, 0] },
                    { text: "ã€Œæˆ‘çœ‹çœ‹å°±å¥½ï¼Œä¸å¤ªæœƒæ‰“ç±ƒçƒã€‚ã€", next: 6, affection: [3, 0, 0] }
                ],
                character: 1
            },
            // ç¬¬1å¤© - é›…é›¯è·¯ç·š
            {
                id: 10,
                text: "ç¬¬äºŒå¤©åˆä¼‘æ™‚é–“ï¼Œä½ ç¨è‡ªåœ¨æ ¡åœ’è£¡æ•£æ­¥ï¼Œç™¼ç¾ç¾è¡“æ•™å®¤çš„é–€è™›æ©è‘—ã€‚é€éé–€ç¸«ï¼Œä½ çœ‹åˆ°ä¸€å€‹å¥³ç”Ÿæ­£åœ¨å°ˆæ³¨åœ°ç•«ç•«ã€‚",
                choices: [
                    { text: "è¼•è¼•æ•²é–€å¾Œé€²å…¥", next: 11, affection: [0, 5, 0] },
                    { text: "åœ¨é–€å¤–éœéœè§€å¯Ÿ", next: 11, affection: [0, 3, 0] },
                    { text: "ç›´æ¥é›¢é–‹", next: 0, affection: [0, 0, 0] }
                ],
                character: 2
            },
            {
                id: 11,
                text: "å¥³ç”Ÿæ³¨æ„åˆ°ä½ ï¼Œæœ‰äº›å®³ç¾åœ°æ”¾ä¸‹ç•«ç­†ã€‚ã€Œå•Š...ä½ å¥½ã€‚æˆ‘æ˜¯ç¾è¡“ç¤¾çš„é™³é›…é›¯ã€‚è«‹å•æœ‰ä»€éº¼äº‹å—ï¼Ÿã€",
                choices: [
                    { text: "ã€Œä½ çš„ç•«å¥½ç¾ï¼æˆ‘å¯ä»¥çœ‹çœ‹å—ï¼Ÿã€", next: 12, affection: [0, 8, 0] },
                    { text: "ã€ŒæŠ±æ­‰æ‰“æ“¾äº†ï¼Œæˆ‘åªæ˜¯è·¯éã€‚ã€", next: 13, affection: [0, 2, 0] }
                ],
                character: 2
            },
            // ç¬¬1å¤© - å°çªè·¯ç·š
            {
                id: 20,
                text: "æ”¾å­¸å¾Œï¼Œä½ åœ¨åœ–æ›¸é¤¨å°‹æ‰¾åƒè€ƒæ›¸æ™‚ï¼Œè½åˆ°ç§‘å­¸ç¤¾æ•™å®¤å‚³ä¾†çˆ†ç‚¸è²ã€‚ä½ å¥½å¥‡åœ°èµ°éå»æŸ¥çœ‹ã€‚",
                choices: [
                    { text: "è¶•ç·Šè·‘éå»çœ‹çœ‹æƒ…æ³", next: 21, affection: [0, 0, 5] },
                    { text: "å»æ‰¾è€å¸«å ±å‘Š", next: 22, affection: [0, 0, 3] }
                ],
                character: 3
            },
            {
                id: 21,
                text: "ç§‘å­¸ç¤¾æ•™å®¤è£¡ç…™éœ§ç€°æ¼«ï¼Œä¸€å€‹æˆ´è‘—è­·ç›®é¡çš„å¥³ç”Ÿæ­£åœ¨å’³å—½ã€‚ã€Œå’³å’³...åˆå¤±æ•—äº†...ã€å¥¹æ³¨æ„åˆ°ä½ ï¼ŒæŒ‘çœ‰å•é“ï¼šã€Œä½ æ˜¯èª°ï¼Ÿæœ‰ä»€éº¼äº‹å—ï¼Ÿã€",
                choices: [
                    { text: "ã€Œæˆ‘è½åˆ°çˆ†ç‚¸è²ï¼Œä¾†çœ‹çœ‹æœ‰æ²’æœ‰éœ€è¦å¹«å¿™çš„ã€‚ã€", next: 23, affection: [0, 0, 8] },
                    { text: "ã€Œé€™è£¡ç™¼ç”Ÿä»€éº¼äº‹äº†ï¼Ÿéœ€è¦å«è€å¸«å—ï¼Ÿã€", next: 22, affection: [0, 0, 3] }
                ],
                character: 3
            },
            // å…¶ä»–æ•…äº‹ç¯€é»...
            {
                id: 50,
                text: "ä¸€é€±å¾Œï¼Œä½ å’Œé¸æ“‡çš„è§’è‰²é—œä¿‚æ›´é€²ä¸€æ­¥ã€‚æŸå¤©æ”¾å­¸å¾Œï¼Œä»–/å¥¹çªç„¶ç´„ä½ åˆ°å­¸æ ¡å¤©å°...",
                choices: [
                    { text: "æº–æ™‚èµ´ç´„", next: 51, affection: [15, 15, 15] },
                    { text: "æ‰¾ç†ç”±å©‰æ‹’", next: 52, affection: [-10, -10, -10] }
                ],
                character: 0 // 0è¡¨ç¤ºä½¿ç”¨ç•¶å‰è§’è‰²
            },
            {
                id: 51,
                text: "å¤©å°ä¸Šï¼Œå¤•é™½çš„é¤˜æš‰å°‡å¤©ç©ºæŸ“æˆæ©˜ç´…è‰²ã€‚ä»–/å¥¹çœ‹è‘—é æ–¹ï¼Œè¼•è²èªªï¼šã€Œå…¶å¯¦...æˆ‘ä¸€ç›´æƒ³å‘Šè¨´ä½ ...ã€",
                choices: [
                    { text: "éœéœç­‰å¾…ä»–/å¥¹èªªå®Œ", next: 53, affection: [20, 20, 20] },
                    { text: "ã€Œä½ æƒ³èªªä»€éº¼ï¼Ÿã€", next: 53, affection: [15, 15, 15] }
                ],
                character: 0
            },
            {
                id: 53,
                text: "ã€Œå’Œä½ åœ¨ä¸€èµ·çš„é€™äº›æ—¥å­ï¼Œæˆ‘å¾ˆé–‹å¿ƒã€‚ä½ é¡˜æ„...ä»¥å¾Œä¹Ÿä¸€èµ·æ”¾å­¸å›å®¶å—ï¼Ÿã€ä»–/å¥¹çš„è‡‰å¾®å¾®æ³›ç´…ã€‚",
                choices: [
                    { text: "ã€Œç•¶ç„¶é¡˜æ„ï¼ã€ï¼ˆå¥½æ„Ÿçµå±€ï¼‰", next: 100, affection: [30, 30, 30] },
                    { text: "ã€Œæˆ‘å€‘é‚„æ˜¯åšæœ‹å‹æ¯”è¼ƒå¥½...ã€ï¼ˆæœ‹å‹çµå±€ï¼‰", next: 101, affection: [-10, -10, -10] }
                ],
                character: 0
            }
        ];
        
        // çµå±€è…³æœ¬
        const endings = {
            100: {
                title: "å¿ƒå‹•çµå±€",
                text: "å¾é‚£å¤©èµ·ï¼Œä½ å€‘é–‹å§‹ä¸€èµ·ä¸Šå­¸ã€æ”¾å­¸ã€‚å¤å¤©çš„é¢¨è¼•è¼•å¹éï¼Œå¸¶è‘—é’æ˜¥çš„ç”œèœœæ°£æ¯ã€‚é€™æ˜¯ä¸€å€‹ç¾å¥½çš„é–‹å§‹ï¼Œä½ å€‘çš„æ•…äº‹å°‡ç¹¼çºŒä¸‹å»...",
                character: 0
            },
            101: {
                title: "æœ‹å‹çµå±€",
                text: "é›–ç„¶æœ‰é»å¤±æœ›ï¼Œä½†ä»–/å¥¹é‚„æ˜¯å°Šé‡ä½ çš„æ±ºå®šã€‚ä½ å€‘æˆç‚ºäº†å¾ˆå¥½çš„æœ‹å‹ï¼Œä¸€èµ·åº¦éäº†è±å¯Œå¤šå½©çš„é«˜ä¸­ç”Ÿæ´»ã€‚",
                character: 0
            },
            102: {
                title: "å–®æˆ€çµå±€",
                text: "å› ç‚ºç¼ºä¹å‹‡æ°£è¡¨é”å¿ƒæ„ï¼Œä½ å€‘çš„é—œä¿‚å§‹çµ‚åœç•™åœ¨æœ‹å‹éšæ®µã€‚ç•¢æ¥­å¾Œå„å¥”æ±è¥¿ï¼Œé€™æ®µé’æ¾€çš„æ„Ÿæƒ…æˆç‚ºå›æ†¶ä¸­çš„æ·¡æ·¡éºæ†¾ã€‚",
                character: 0
            }
        };
        
        // DOMå…ƒç´ 
        const storyTextElement = document.getElementById('story-text');
        const choicesContainer = document.getElementById('choices-container');
        const characterPortraitElement = document.getElementById('character-portrait');
        const characterNameElement = document.getElementById('character-name');
        const characterPersonalityElement = document.getElementById('character-personality');
        const affectionFillElement = document.getElementById('affection-fill');
        const affectionValueElement = document.getElementById('affection-value');
        const charSelectButtons = document.querySelectorAll('.char-select-btn');
        const restartButton = document.getElementById('restart-btn');
        const saveButton = document.getElementById('save-btn');
        const historyButton = document.getElementById('history-btn');
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            gameData.currentCharacter = 1;
            gameData.day = 1;
            gameData.affection = [0, 0, 0];
            gameData.storyProgress = 0;
            gameData.storyHistory = [];
            gameData.selectedChoices = [];
            
            updateCharacterDisplay();
            loadStory(0);
            updateAffectionDisplay();
            
            // åˆå§‹åŒ–è§’è‰²é¸æ“‡æŒ‰éˆ•
            charSelectButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const charId = parseInt(this.getAttribute('data-char'));
                    switchCharacter(charId);
                });
            });
        }
        
        // åˆ‡æ›è§’è‰²
        function switchCharacter(charId) {
            gameData.currentCharacter = charId;
            
            // æ›´æ–°é¸æ“‡æŒ‰éˆ•ç‹€æ…‹
            charSelectButtons.forEach(btn => {
                if (parseInt(btn.getAttribute('data-char')) === charId) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            updateCharacterDisplay();
            updateAffectionDisplay();
        }
        
        // æ›´æ–°è§’è‰²é¡¯ç¤º
        function updateCharacterDisplay() {
            const char = characters[gameData.currentCharacter];
            
            characterPortraitElement.innerHTML = `<span style="font-size: 5rem;">${char.emoji}</span>`;
            characterNameElement.textContent = char.name;
            characterPersonalityElement.textContent = char.personality;
            
            // æ›´æ–°é¡è‰²ä¸»é¡Œ
            document.documentElement.style.setProperty('--char-color', char.color);
        }
        
        // æ›´æ–°å¥½æ„Ÿåº¦é¡¯ç¤º
        function updateAffectionDisplay() {
            const affection = gameData.affection[gameData.currentCharacter - 1];
            const percentage = Math.min(100, Math.max(0, affection));
            
            affectionFillElement.style.width = `${percentage}%`;
            affectionFillElement.textContent = `${percentage}%`;
            affectionValueElement.textContent = `${affection}/100`;
            
            // å¦‚æœå¥½æ„Ÿåº¦é«˜ï¼Œé¡¯ç¤ºæ„›å¿ƒç‰¹æ•ˆ
            if (affection >= 70 && gameData.storyProgress > 5) {
                showHearts();
            }
        }
        
        // é¡¯ç¤ºæ„›å¿ƒç‰¹æ•ˆ
        function showHearts() {
            const container = characterPortraitElement;
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.textContent = 'â¤';
                    heart.style.left = `${Math.random() * 100}%`;
                    heart.style.top = `${Math.random() * 100}%`;
                    
                    container.appendChild(heart);
                    
                    // å‹•ç•«
                    heart.style.animation = 'floatUp 1.5s ease forwards';
                    
                    // ç§»é™¤å…ƒç´ 
                    setTimeout(() => {
                        heart.remove();
                    }, 1500);
                }, i * 200);
            }
        }
        
        // è¼‰å…¥æ•…äº‹
        function loadStory(storyId) {
            const story = storyScript.find(s => s.id === storyId);
            if (!story) {
                // å¦‚æœæ˜¯çµå±€ID
                if (endings[storyId]) {
                    showEnding(storyId);
                    return;
                }
                // é»˜èªè¼‰å…¥ç¬¬ä¸€å€‹æ•…äº‹
                loadStory(0);
                return;
            }
            
            gameData.storyProgress = storyId;
            gameData.storyHistory.push(story.text);
            
            // é¡¯ç¤ºæ•…äº‹æ–‡æœ¬
            storyTextElement.textContent = story.text;
            
            // æ¸…é™¤èˆŠçš„é¸æ“‡æŒ‰éˆ•
            choicesContainer.innerHTML = '';
            
            // å–å¾—ç•¶å‰è§’è‰²
            const currentChar = story.character === 0 ? gameData.currentCharacter : story.character;
            
            // å‰µå»ºæ–°çš„é¸æ“‡æŒ‰éˆ•
            story.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.setAttribute('data-choice', index);
                
                const choiceText = document.createElement('span');
                choiceText.className = 'choice-text';
                choiceText.textContent = choice.text;
                
                button.appendChild(choiceText);
                
                button.addEventListener('click', () => {
                    makeChoice(choice, currentChar);
                });
                
                choicesContainer.appendChild(button);
            });
            
            // å¦‚æœæœ‰è§’è‰²è®ŠåŒ–ï¼Œæ›´æ–°é¡¯ç¤º
            if (story.character !== 0 && story.character !== gameData.currentCharacter) {
                switchCharacter(story.character);
            }
        }
        
        // åšå‡ºé¸æ“‡
        function makeChoice(choice, characterId) {
            // è¨˜éŒ„é¸æ“‡
            gameData.selectedChoices.push({
                storyId: gameData.storyProgress,
                choice: choice.text,
                character: characterId
            });
            
            // æ›´æ–°å¥½æ„Ÿåº¦
            if (choice.affection && choice.affection[characterId - 1]) {
                gameData.affection[characterId - 1] += choice.affection[characterId - 1];
                gameData.affection[characterId - 1] = Math.max(0, Math.min(100, gameData.affection[characterId - 1]));
                
                // é¡¯ç¤ºå¥½æ„Ÿåº¦è®ŠåŒ–
                showAffectionChange(choice.affection[characterId - 1]);
            }
            
            // æ›´æ–°é¡¯ç¤º
            updateAffectionDisplay();
            
            // æª¢æŸ¥æ˜¯å¦é”åˆ°çµå±€æ¢ä»¶
            if (gameData.affection[characterId - 1] >= 80 && gameData.storyProgress >= 5) {
                // é€²å…¥çµå±€è·¯ç·š
                loadStory(50);
            } else if (gameData.affection[characterId - 1] <= 20 && gameData.storyProgress >= 5) {
                // ä½å¥½æ„Ÿåº¦çµå±€
                loadStory(102);
            } else {
                // è¼‰å…¥ä¸‹ä¸€å€‹æ•…äº‹
                loadStory(choice.next);
            }
        }
        
        // é¡¯ç¤ºå¥½æ„Ÿåº¦è®ŠåŒ–
        function showAffectionChange(change) {
            const charSection = document.querySelector('.character-section');
            const changeElement = document.createElement('div');
            changeElement.textContent = change > 0 ? `+${change}` : `${change}`;
            changeElement.style.position = 'absolute';
            changeElement.style.color = change > 0 ? '#ff4d8d' : '#777';
            changeElement.style.fontWeight = 'bold';
            changeElement.style.fontSize = '1.5rem';
            changeElement.style.zIndex = '100';
            changeElement.style.left = '50%';
            changeElement.style.top = '50%';
            changeElement.style.transform = 'translate(-50%, -50%)';
            
            charSection.appendChild(changeElement);
            
            // å‹•ç•«
            changeElement.style.transition = 'all 0.8s ease';
            setTimeout(() => {
                changeElement.style.opacity = '0';
                changeElement.style.transform = 'translate(-50%, -100px)';
            }, 100);
            
            // ç§»é™¤å…ƒç´ 
            setTimeout(() => {
                changeElement.remove();
            }, 1000);
        }
        
        // é¡¯ç¤ºçµå±€
        function showEnding(endingId) {
            const ending = endings[endingId];
            
            storyTextElement.innerHTML = `
                <h2 style="color: #ff6b9d; margin-bottom: 20px; text-align: center;">${ending.title}</h2>
                <p style="font-size: 1.4rem; line-height: 1.6; margin-bottom: 30px;">${ending.text}</p>
                <div style="text-align: center; margin-top: 30px;">
                    <p style="font-size: 1.2rem; color: #666;">æœ€çµ‚å¥½æ„Ÿåº¦: ${gameData.affection[gameData.currentCharacter - 1]}/100</p>
                    <p style="font-size: 1.2rem; color: #666; margin-top: 10px;">æ•…äº‹é•·åº¦: ${gameData.day}å¤©</p>
                </div>
            `;
            
            // é¡¯ç¤ºçµå±€é¸é …
            choicesContainer.innerHTML = '';
            
            const restartBtn = document.createElement('button');
            restartBtn.className = 'choice-btn';
            restartBtn.innerHTML = '<span class="choice-text">é‡æ–°é–‹å§‹éŠæˆ²</span>';
            restartBtn.addEventListener('click', initGame);
            
            const reviewBtn = document.createElement('button');
            reviewBtn.className = 'choice-btn';
            reviewBtn.innerHTML = '<span class="choice-text">å›é¡§æ•…äº‹æ­·ç¨‹</span>';
            reviewBtn.addEventListener('click', showStoryHistory);
            
            choicesContainer.appendChild(restartBtn);
            choicesContainer.appendChild(reviewBtn);
        }
        
        // é¡¯ç¤ºæ•…äº‹æ­·å²
        function showStoryHistory() {
            let historyHTML = '<h3 style="color: #65c7f7; margin-bottom: 15px;">æ•…äº‹æ­·ç¨‹</h3>';
            
            gameData.storyHistory.forEach((text, index) => {
                historyHTML += `<p style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #eee;">${text}</p>`;
            });
            
            storyTextElement.innerHTML = historyHTML;
            
            // è¿”å›æŒ‰éˆ•
            choicesContainer.innerHTML = '';
            const backBtn = document.createElement('button');
            backBtn.className = 'choice-btn';
            backBtn.innerHTML = '<span class="choice-text">è¿”å›éŠæˆ²</span>';
            backBtn.addEventListener('click', () => {
                if (gameData.storyProgress >= 100) {
                    // å¦‚æœæ˜¯çµå±€å¾Œï¼Œé¡¯ç¤ºçµå±€
                    showEnding(gameData.storyProgress);
                } else {
                    // å¦å‰‡é‡æ–°è¼‰å…¥ç•¶å‰æ•…äº‹
                    loadStory(gameData.storyProgress);
                }
            });
            
            choicesContainer.appendChild(backBtn);
        }
        
        // ä¿å­˜éŠæˆ²é€²åº¦
        function saveGame() {
            const saveData = {
                ...gameData,
                saveDate: new Date().toLocaleString()
            };
            
            localStorage.setItem('summerLoveGameSave', JSON.stringify(saveData));
            
            // é¡¯ç¤ºä¿å­˜æˆåŠŸè¨Šæ¯
            const originalText = storyTextElement.textContent;
            storyTextElement.textContent = "éŠæˆ²é€²åº¦å·²ä¿å­˜ï¼";
            storyTextElement.style.color = "#27ae60";
            
            setTimeout(() => {
                storyTextElement.textContent = originalText;
                storyTextElement.style.color = "";
            }, 1500);
        }
        
        // è¼‰å…¥éŠæˆ²é€²åº¦
        function loadGame() {
            const savedData = localStorage.getItem('summerLoveGameSave');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                Object.assign(gameData, parsedData);
                
                updateCharacterDisplay();
                loadStory(gameData.storyProgress);
                updateAffectionDisplay();
                
                // é¡¯ç¤ºè¼‰å…¥æˆåŠŸè¨Šæ¯
                storyTextElement.textContent = `éŠæˆ²é€²åº¦å·²è¼‰å…¥ï¼ï¼ˆä¿å­˜æ™‚é–“ï¼š${parsedData.saveDate}ï¼‰`;
                setTimeout(() => {
                    loadStory(gameData.storyProgress);
                }, 2000);
            } else {
                storyTextElement.textContent = "æ²’æœ‰æ‰¾åˆ°ä¿å­˜çš„éŠæˆ²é€²åº¦ã€‚";
                setTimeout(() => {
                    loadStory(gameData.storyProgress);
                }, 1500);
            }
        }
        
        // äº‹ä»¶ç›£è½å™¨
        restartButton.addEventListener('click', initGame);
        saveButton.addEventListener('click', saveGame);
        historyButton.addEventListener('click', showStoryHistory);
        
        // åˆå§‹åŒ–éŠæˆ²
        initGame();
        
        // å˜—è©¦è¼‰å…¥ä¿å­˜çš„é€²åº¦
        window.addEventListener('load', () => {
            setTimeout(loadGame, 500);
        });
    </script>
</body>
</html>