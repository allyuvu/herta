<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å¤æ—¥å‘Šç™½ï¼šæœ€å¾Œçš„ 7 å¤© - å®Œæ•´é«˜ç´šç‰ˆ</title>
    <style>
        :root { --main: #ff85a2; --glass: rgba(255, 255, 255, 0.9); --accent: #74b9ff; }
        body { margin: 0; background: #000; font-family: 'Segoe UI', "Microsoft JhengHei", sans-serif; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        #game-container { 
            width: 1024px; height: 640px; background: #222; position: relative; 
            overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        /* æ¸²æŸ“å±¤ */
        #bg-layer { width: 100%; height: 100%; background-size: cover; background-position: center; transition: 1.5s filter, 1s background; }
        #char-layer { 
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); 
            height: 95%; transition: 0.5s all cubic-bezier(0.4, 0, 0.2, 1); z-index: 5; 
            font-size: 400px; display: flex; align-items: flex-end;
        }
        .char-hit { transform: translateX(-50%) scale(1.05); filter: brightness(1.2); }

        /* é ‚éƒ¨è³‡è¨Šæ¬„ */
        #top-ui {
            position: absolute; top: 0; width: 100%; height: 60px; 
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            display: flex; align-items: center; padding: 0 30px; color: #fff; z-index: 20;
        }
        .stat { margin-right: 30px; display: flex; align-items: center; gap: 8px; font-weight: bold; }
        .stat-val { color: var(--main); text-shadow: 0 0 10px var(--main); }

        /* å°è©±ç³»çµ± */
        #msg-window {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 960px; height: 180px; background: var(--glass);
            border-radius: 15px; border: 3px solid white;
            padding: 30px; box-sizing: border-box; z-index: 100; cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #name-label {
            position: absolute; top: -20px; left: 40px; background: var(--main);
            color: white; padding: 6px 30px; border-radius: 30px; font-weight: bold; font-size: 24px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        #text-content { font-size: 24px; color: #333; line-height: 1.7; letter-spacing: 1px; }

        /* é¸é …ç³»çµ± */
        #choice-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 500; backdrop-filter: blur(5px);
        }
        .choice-btn {
            width: 550px; padding: 20px; margin: 12px; background: white;
            border-radius: 15px; border: none; color: #333;
            font-size: 20px; font-weight: bold; cursor: pointer; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); text-align: center;
        }
        .choice-btn:hover { background: var(--main); color: white; transform: translateY(-3px); }

        /* èƒŒåŒ…/ç³»çµ±æŒ‰éˆ• */
        .sys-btn { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 5px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        
        /* å‹•ç•«ç‰¹æ•ˆ */
        #flash { position: absolute; width: 100%; height: 100%; background: #fff; opacity: 0; pointer-events: none; z-index: 999; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="bg-layer"></div>
    <div id="char-layer"></div>
    <div id="flash"></div>

    <div id="top-ui">
        <div class="stat">ğŸ“… <span id="ui-day">Day 1</span></div>
        <div class="stat">ğŸ•’ <span id="ui-time">ä¸Šåˆ</span></div>
        <div class="stat">â¤ï¸ <span id="ui-love" class="stat-val">0</span></div>
        <div class="stat">ğŸ“š <span id="ui-int" class="stat-val">10</span></div>
        <div class="stat">âœ¨ <span id="ui-cha" class="stat-val">10</span></div>
        <div style="flex-grow: 1"></div>
        <button class="sys-btn" onclick="sys.save()">å¿«é€Ÿå­˜æª”</button>
        <button class="sys-btn" onclick="sys.load()">è¼‰å…¥é€²åº¦</button>
    </div>

    <div id="msg-window" onclick="core.next()">
        <div id="name-label">æ›‰æ™´</div>
        <div id="text-content">æ­£åœ¨è®€å–æ ¡åœ’è¨˜æ†¶...</div>
    </div>

    <div id="choice-layer"></div>
</div>

<script>
/**
 * æ ¸å¿ƒå¼•æ“ï¼šæ”¯æ´åˆ†æ”¯è·³è½‰ã€æ¢ä»¶åˆ¤å®šèˆ‡å±¬æ€§å½±éŸ¿
 */
const core = {
    state: {
        love: 0, int: 10, cha: 10,
        day: 1, timeIdx: 0, 
        currentSlot: 'intro',
        lineIdx: 0,
        flags: new Set(),
        inventory: [],
        isTyping: false
    },

    times: ["ä¸Šåˆ", "ä¸‹åˆ", "é»ƒæ˜", "æ·±å¤œ"],
    
    script: {
        // --- åºç«  ---
        intro: [
            { bg: 'linear-gradient(to top, #a1c4fd 0%, #c2e9fb 100%)', char: '' },
            { name: 'æˆ‘', text: 'é‚£æ˜¯èŸ¬é³´æœ€éŸ¿äº®çš„ä¸€å€‹å¤å¤©ã€‚' },
            { name: 'æˆ‘', text: 'é‚„æœ‰ä¸ƒå¤©ï¼Œæˆ‘å€‘å°±è¦å„å¥”æ±è¥¿äº†ã€‚' },
            { char: 'ğŸ‘§', name: 'ï¼Ÿï¼Ÿï¼Ÿ', text: 'ã€Œå­¸â€”â€”é•·ï¼ä½ åˆåœ¨é ‚æ¨“å¹é¢¨äº†ï¼ã€' },
            { name: 'æˆ‘', text: 'å¥¹æ˜¯è˜‡æ›‰æ™´ï¼Œæˆ‘é€™è¼©å­è¦‹éæœ€éº»ç…©ã€ä¹Ÿæœ€æ”¾ä¸ä¸‹çš„å¥³ç”Ÿã€‚' },
            { choice: [
                { text: 'ã€Œå› ç‚ºåœ¨ç­‰ä½ å•Šã€‚ã€', next: 'intro_flirt', love: 10, cha: 5 },
                { text: 'ã€Œé€™è£¡å®‰éœï¼Œé©åˆèƒŒå…¬å¼ã€‚ã€', next: 'intro_study', int: 10 },
                { text: 'ã€Œåªæ˜¯åœ¨çœ‹é›²ã€‚ã€', next: 'intro_normal' }
            ]}
        ],
        intro_flirt: [
            { char: 'ğŸ˜³', name: 'è˜‡æ›‰æ™´', text: 'ã€Œä½ ã€ä½ ä»Šå¤©åƒéŒ¯è—¥äº†å—ï¼Ÿçªç„¶èªªé€™ç¨®è®“äººèª¤æœƒçš„è©±...ã€' },
            { name: 'æˆ‘', text: 'å¥¹çš„è‡‰ç´…å¾—åƒç†Ÿé€çš„è˜‹æœã€‚çœ‹ä¾†é­…åŠ›å€¼ç™¼æ®ä½œç”¨äº†ã€‚' },
            { call: () => core.jump('daily_map') }
        ],
        intro_study: [
            { char: 'ğŸ˜’', name: 'è˜‡æ›‰æ™´', text: 'ã€ŒçœŸæ˜¯å€‹ä¸è§£é¢¨æƒ…çš„æ›¸å‘†å­ã€‚æ‹¿å»ï¼Œé€™æ˜¯ä½ å¿˜åœ¨æ•™å®¤çš„åƒè€ƒæ›¸ã€‚ã€' },
            { msg: 'ç²å¾—äº†ã€æ›‰æ™´çš„åƒè€ƒæ›¸ã€‘', call: () => core.state.inventory.push('åƒè€ƒæ›¸') },
            { call: () => core.jump('daily_map') }
        ],
        intro_normal: [
            { char: 'ğŸ˜Š', name: 'è˜‡æ›‰æ™´', text: 'ã€Œé›²æœ‰ä»€éº¼å¥½çœ‹çš„ï¼Ÿå°äº†ï¼Œä¸‹åˆå­¸æ ¡å¾Œé–€æœ‰ç¥­å…¸ï¼Œè¦ä¸è¦å»ï¼Ÿã€' },
            { call: () => core.jump('daily_map') }
        ],

        // --- åœ°é»é¸æ“‡ç³»çµ± ---
        daily_map: [
            { bg: 'linear-gradient(120deg, #f6d365 0%, #fda085 100%)', char: '', name: 'ç³»çµ±', text: 'ç¾åœ¨æ˜¯è‡ªç”±è¡Œå‹•æ™‚é–“ï¼Œä½ æƒ³å»å“ªè£¡ï¼Ÿ' },
            { choice: [
                { text: 'ğŸ« åœ–æ›¸é¤¨ (æ™ºåŠ›+10)', next: 'loc_library' },
                { text: 'ğŸ€ é«”è‚²é¤¨ (é­…åŠ›+10)', next: 'loc_gym' },
                { text: 'ğŸŒ³ å¾ŒèŠ±åœ’ (é‡è¦‹æ›‰æ™´)', next: 'loc_garden' },
                { text: 'ğŸ  å›å®¶ (ä¼‘æ¯/å­˜æª”)', next: 'loc_home' }
            ]}
        ],

        loc_library: [
            { name: 'æˆ‘', text: 'åœ¨éœè¬çš„æ›¸é¦™ä¸­ï¼Œæˆ‘è¦ºå¾—å¤§è…¦é‹è½‰å¿«äº†ä¸å°‘ã€‚' },
            { call: () => { core.state.int += 10; core.advance(); } }
        ],
        loc_gym: [
            { name: 'æˆ‘', text: 'åœ¨çƒå ´æ®ç‘æ±—æ°´ï¼Œæ„Ÿè¦ºè‡ªå·±å……æ»¿äº†æ´»åŠ›ã€‚' },
            { call: () => { core.state.cha += 10; core.advance(); } }
        ],
        loc_garden: [
            { char: 'ğŸ‘§', name: 'è˜‡æ›‰æ™´', text: 'ã€Œå˜¿ï¼æ²’æƒ³åˆ°æœƒåœ¨é€™è£¡é‡åˆ°ä½ ã€‚æ—¢ç„¶ä¾†äº†ï¼Œå¹«æˆ‘å€‹å¿™å§ï¼Ÿã€' },
            { choice: [
                { text: 'å¹«å¥¹ä¿®å‰ªèŠ±æœ¨ (å¥½æ„Ÿ+15)', next: 'garden_help', love: 15 },
                { text: 'é™ªå¥¹èŠå¤© (å¥½æ„Ÿ+5, é­…åŠ›+5)', next: 'garden_chat', love: 5, cha: 5 }
            ]}
        ],
        garden_help: [
            { char: 'âœ¨', name: 'è˜‡æ›‰æ™´', text: 'ã€Œçœ‹ä¸å‡ºä¾†ä½ æ‰‹é‚„æŒºå·§çš„å˜›ï¼çå‹µä½ ä¸€é¡†ç³–æœã€‚ã€' },
            { call: () => core.advance() }
        ],
        garden_chat: [
            { name: 'æˆ‘', text: 'æˆ‘å€‘èŠäº†å¾ˆä¹…ï¼Œé—œæ–¼æœªä¾†çš„å¿—é¡˜ï¼Œé‚„æœ‰é‚£äº›æ²’èªªå‡ºå£çš„ç´„å®šã€‚' },
            { call: () => core.advance() }
        ],

        loc_home: [
            { name: 'ç³»çµ±', text: 'ä¼‘æ¯å¾Œï¼Œé«”åŠ›æ¢å¾©äº†ã€‚ä½ è¦ç¹¼çºŒæˆ°é¬¥å—ï¼Ÿ' },
            { call: () => core.advance() }
        ],

        // --- çµå±€åˆ¤å®š ---
        ending_check: [
            { bg: '#000', char: '', name: 'æ—ç™½', text: 'ä¸ƒå¤©éå»äº†ã€‚èŸ¬é³´è²æ¼¸æ¼¸æ¶ˆå¤±ï¼Œç•¢æ¥­çš„é˜è²éŸ¿èµ·ã€‚' },
            { call: () => {
                if(core.state.love >= 80) core.jump('ending_true');
                else if(core.state.love >= 40) core.jump('ending_normal');
                else core.jump('ending_bad');
            }}
        ],
        ending_true: [
            { bg: 'pink', char: 'ğŸ‘©â€â¤ï¸â€ğŸ‘¨', name: 'è˜‡æ›‰æ™´', text: 'ã€Œå­¸é•·ï¼Œå…¶å¯¦æˆ‘ä¸€ç›´...éƒ½å–œæ­¡è‘—ä½ ã€‚æˆ‘å€‘ä¸€èµ·å»æ±äº¬è®€å¤§å­¸å§ï¼ã€' },
            { name: 'çµå±€', text: 'ã€çœŸçµå±€ï¼šå¤æ—¥çš„æ°¸æ†å‘Šç™½ã€‘' }
        ],
        ending_bad: [
            { bg: 'gray', char: 'ğŸš¶', name: 'æˆ‘', text: 'æœ€å¾Œï¼Œæˆ‘å€‘åªæ˜¯åœ¨ç•¢æ¥­å…¸ç¦®ä¸Šé»äº†é»é ­ã€‚é’æ˜¥å°±åƒé€™å ´å¤æ—¥ï¼Œçµ‚ç©¶æœƒçµæŸã€‚' },
            { name: 'çµå±€', text: 'ã€å£çµå±€ï¼šéºæ†¾çš„å¹³è¡Œç·šã€‘' }
        ]
    },

    init() {
        this.render();
    },

    render() {
        const line = this.script[this.state.currentSlot][this.state.lineIdx];
        if (!line) return;

        // è™•ç†èƒŒæ™¯èˆ‡ç«‹ç¹ª
        if (line.bg) document.getElementById('bg-layer').style.background = line.bg;
        if (line.char !== undefined) {
            const c = document.getElementById('char-layer');
            c.innerText = line.char;
            c.classList.add('char-hit');
            setTimeout(() => c.classList.remove('char-hit'), 300);
        }

        // è™•ç†ç‰¹æ®Šå‘¼å«
        if (line.call) line.call();
        if (line.msg) alert(line.msg);

        // è™•ç†åˆ†æ”¯
        if (line.choice) {
            this.showChoices(line.choice);
        } else {
            document.getElementById('name-label').innerText = line.name || "";
            this.type(line.text || "");
        }
        this.updateUI();
    },

    type(txt) {
        this.state.isTyping = true;
        let i = 0;
        const el = document.getElementById('text-content');
        el.innerText = "";
        const timer = setInterval(() => {
            el.innerText += txt[i] || "";
            i++;
            if (i >= txt.length) {
                clearInterval(timer);
                this.state.isTyping = false;
            }
        }, 40);
    },

    next() {
        if (this.state.isTyping) return;
        const slot = this.script[this.state.currentSlot];
        if (this.state.lineIdx < slot.length - 1) {
            this.state.lineIdx++;
            this.render();
        }
    },

    jump(slot) {
        this.state.currentSlot = slot;
        this.state.lineIdx = 0;
        this.render();
    },

    showChoices(choices) {
        const layer = document.getElementById('choice-layer');
        layer.innerHTML = "";
        layer.style.display = "flex";
        choices.forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = c.text;
            btn.onclick = () => {
                if (c.love) this.state.love += c.love;
                if (c.int) this.state.int += c.int;
                if (c.cha) this.state.cha += c.cha;
                layer.style.display = "none";
                this.jump(c.next);
            };
            layer.appendChild(btn);
        });
    },

    advance() {
        this.state.timeIdx++;
        if (this.state.timeIdx >= 4) {
            this.state.timeIdx = 0;
            this.state.day++;
        }
        if (this.state.day > 7) {
            this.jump('ending_check');
        } else {
            this.jump('daily_map');
        }
    },

    updateUI() {
        document.getElementById('ui-day').innerText = `Day ${this.state.day}`;
        document.getElementById('ui-time').innerText = this.times[this.state.timeIdx];
        document.getElementById('ui-love').innerText = this.state.love;
        document.getElementById('ui-int').innerText = this.state.int;
        document.getElementById('ui-cha').innerText = this.state.cha;
    }
};

const sys = {
    save() { localStorage.setItem('summer_save', JSON.stringify(core.state)); alert('é€²åº¦å·²è¨˜éŒ„åœ¨ç€è¦½å™¨ä¸­ï¼'); },
    load() {
        const d = localStorage.getItem('summer_save');
        if (d) { core.state = JSON.parse(d); core.render(); }
    }
};

core.init();
</script>
</body>
</html>